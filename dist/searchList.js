define("widget/searchList/1.0.0/searchList",["$","handlebars"],function(require,exports,module){var $=require("$"),Handlebars=require("handlebars"),searchList={init:function(a){return this.options=a,this.eles=$(this.options.eles),this.eles.data("options",a),this.f_kw="",this.type=a.type||"getJSON",this.listTpl="#"===(this.options.tpl+"").charAt(0)?$(this.options.tpl).html():this.options.tpl,this.eleInit(),this.search(),this.options.filter&&this.filter(),this.curSearchBox,this.eles},eleInit:function(){var a=this;this.eles.each(function(){var b=$(this),c=b.outerHeight(!0),d="";d+=a.options.keydown?'<i class="kuma-icon kuma-icon-search J-search" style="display:none;"></i>':'<i class="kuma-icon kuma-icon-search J-search"></i>',d+=a.options.filter?'<div class="dropDownBox" style="top:'+(c+2)+'px"><p class="filterBox"><input type="text" placeholder="请输入关键词过滤" class="cin-filter"></p><ul></ul></div>':'<div class="dropDownBox" style="top:'+(c+2)+'px"><ul></ul></div>',$(this).append(d)})},MVC:function(a){var b=this;return Handlebars.registerHelper("filter",function(a){if(b.f_kw.length){var c=new RegExp(b.f_kw,"mg");return a.replace(c,function(a){return'<span class="kw">'+a+"</span>"})}return a}),Handlebars.compile(a)},search:function(){var This=this,getTplObj="";This.eles.on("click",".J-search",function(){var $this=$(this),searchBox=$this.closest(".searchList"),oinput=searchBox.find(".cin-keyword"),kw=$.trim(oinput.val()),dropDown=searchBox.find(".dropDownBox"),dropDownUl=dropDown.find("ul"),HtmlList="",_O={};This.curSearchBox=searchBox,This.options=This.curSearchBox.data("options")||This.options,This.listTpl="#"===(This.options.tpl+"").charAt(0)?$(This.options.tpl).html():This.options.tpl,getTplObj=This.listTpl.match("{{#each (.+)}}","i")[1],_O[oinput.attr("name")||"keyword"]=kw,_O=$.extend(This.options.param,_O),_O._=+new Date,$(".searchList").find(".dropDownBox").hide(),This.f_kw="",$[This.type](This.options.portUrl,_O,function(data){HtmlList=This.MVC(This.listTpl)(data),dropDownUl.html(HtmlList).data("cacheListData",{listData:data,listArr:eval("(data."+getTplObj+")"),cacheArrStr:JSON.stringify(eval("(data."+getTplObj+")"))}),HtmlList&&dropDown.show()},"JSON")}),This.eles.find(".cin-keyword").on("keyup",function(a){a=a||event,This.curSearchBox=$(this).closest(".searchList"),This.options=This.curSearchBox.data("options")||This.options;var b=a.keyCode||a.which||a.charCode,c=13===b,d=37===b||38===b||39===b||40===b||16===b||17===b||18===b;!This.options.keydown||c||d?c&&!This.options.keydown&&$(this).closest(".searchList").find(".J-search").trigger("click"):$(this).closest(".searchList").find(".J-search").trigger("click")}),This.eles.on("click",function(a){a.stopPropagation()}),$(document).on("click",function(){$(".searchList").find(".dropDownBox").hide()})},filter:function(){var a=this,b=(a.listTpl.match("{{#each (.+)}}","i")[1],a.listTpl.match(">{{{filter (.+)}}}</a>","i")[1]);a.eles.find(".cin-filter").on("keyup",function(){var c=$(this),d=c.closest(".dropDownBox"),e=d.find("ul"),f=e.data("cacheListData"),g=f.listData,h=f.cacheArrStr,i=f.listArr;kw=$.trim($(this).val());var j=$.parseJSON(h);kw.length>0?(i.length=0,a.f_kw=kw,$.each(j,function(a,c){var d=c[b],e=new RegExp(kw,"mg");e.test(d)&&i.push(c)})):(i.length=0,$.each(j,function(a,b){i.push(b)}),a.f_kw=""),HtmlList=a.MVC(a.listTpl)(g),e.html(HtmlList),HtmlList&&d.show()})}};module.exports=searchList});
